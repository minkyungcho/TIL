## 검색의 기본

### SELECT 문의 기본

- 테이블에서 데이터를 선택하려면 SELECT 문을 사용한다.
- 열에는 표시용 별명을 붙일 수 있다.
- SELECT 구에는 상수나 식을 쓸 수 있다.
- DISTINCT 키워드를 지정하면 중복된 행을 제거할 수 있다
- SQL 문 안에 메모를 남기기 위해서 '주석'을 작성할 수 있다.
- WHERE 구를 사용해서 검색 조건에 부합하는 행을 테이블에서 선택할 수 있다.

열을 출력한다

``` SQL
SELECT JOB, SAL FROM EMP;
```

모든 열을 출력한다.

``` SQL
SELECT * FROM EMP;
```

열에 별명을 부여하자

```SQL
SELECT ENAME AS NAME, SAL AS "MON SAL" FROM EMP; 
```

상수 출력

```SQL
SELECT 'HI' AS NAME, 1000 AS SAL, '2019-05-31' AS TODAY FROM EMP;
-- NAME 열에 HI 문자열 상수 쭉, SAL 열에 1000 숫자 상수 쭉, TODAY 열에 2019-05-31 날짜 상수 쭉 있는 테이블 출력
```

결과에서 중복 행을 제거

``` SQL
SELECT DISTINCT(JOB) FROM EMP;
```

WHERE 구를 사용한 행 선택

``` SQL
SELECT * FROM EMP WHERE JOB = 'MANAGER';
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND SAL > 2500;
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND SAL > 2500 AND HIREDATE > '04/15/1981';
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND ENAME LIKE '%A%';
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND ENAME LIKE 'C%';
```

주석 작성법

```SQL
SELECT * FROM EMP 
-- where statement.
WHERE JOB = 'MANAGER' 
/*
Multi Comments ..
*/
AND ENAME LIKE '%A%';
```

### 산술 연산자와 비교 연산자

산술 연산자

``` SQL
SELECT JOB, SAL, COMM, SAL+COMM FROM EMP;
SELECT JOB, SAL, 
-- 연봉을 계산하시오. 단, SAL의 세금은 13%, COMM의 세금은 12%.
COMM, 12*(SAL*0.87+COMM*0.88) AS "ANN SAL" FROM EMP;

SELECT JOB, SAL, 12*(SAL*0.87+NVL(COMM,0)*0.88) AS "ANN SAL" FROM EMP; -- NVL 활용하기. NULL 주의
SELECT ENAME, NVL2(COMM,'0','1') FROM EMP; -- NULL이면 0, 아니면 1

SELECT JOB, SAL, 12*(SAL*0.87+NVL(COMM,0)*0.88) AS "ANN SAL" FROM EMP WHERE "ANN SAL" > 30000; -- 에러
SELECT JOB, SAL, 12*(SAL*0.87+NVL(COMM,0)*0.88) AS "ANN SAL" FROM EMP WHERE 12*(SAL*0.87+NVL(COMM,0)*0.88) > 30000; -- 정상 실행
```

비교 연산자

``` SQL
SELECT SAL, 12*(SAL*0.87+NVL(COMM,0)*0.88) AS "ANN SAL" FROM EMP WHERE 12*(SAL*0.87+NVL(COMM,0)*0.88) = 31320;
SELECT SAL, 12*(SAL*0.87+NVL(COMM,0)*0.88) AS "ANN SAL" FROM EMP WHERE 12*(SAL*0.87+NVL(COMM,0)*0.88) <> 31320; -- <>와 != 는 같은 의미

SELECT ENAME FROM EMP WHERE COMM = NULL; -- 에러
SELECT ENAME FROM EMP WHERE COMM IS NULL; -- 정상 실행
SELECT ENAME FROM EMP WHERE COMM IS NOT NULL;
```

### 논리 연산자

NOT 연산자

``` SQL
SELECT ENAME FROM EMP WHERE SAL >= 2000;
SELECT ENAME FROM EMP WHERE NOT SAL >= 2000;
SELECT ENAME FROM EMP WHERE SAL < 2000;
```

AND 연산자와 OR 연산자

```SQL
SELECT ENAME FROM EMP WHERE SAL < 2000 AND DEPTNO=30;
SELECT ENAME FROM EMP WHERE (SAL < 2000 AND DEPTNO=30) OR (ENAME LIKE '%E%'); -- 연산 순서는 앞에서부터
```

괄호를 사용하면 강해진다

```SQL
SELECT * FROM EMP WHERE JOB = 'CLERK'
AND DEPTNO = 10 OR DEPTNO = 20;

SELECT * FROM EMP WHERE JOB = 'CLERK'
AND (DEPTNO = 10 OR DEPTNO = 20);
SELECT * FROM EMP WHERE JOB = 'CLERK'
AND NOT (DEPTNO = 10 OR DEPTNO = 20);
```

### 검색 결과를 재정렬한다.

``` sql
SELECT ENAME, SAL FROM EMP ORDER BY SAL; -- 오름차순(낮은것 부터) 
SELECT ENAME, SAL FROM EMP ORDER BY SAL DESC; -- 내림차순
SELECT ENAME, SAL FROM EMP ORDER BY 2; -- 2열(SAL) 기준으로 정렬

SELECT ENAME, SAL, SAL*12 FROM EMP WHERE SAL > 1000
AND DEPTNO = 20 ORDER BY 3; -- 3열(SAL*12) 기준으로 정렬
SELECT ENAME, SAL, SAL*12 AS ASAL FROM EMP WHERE SAL > 1000
AND DEPTNO = 20 ORDER BY ASAL; --ASAL 기준으로 정렬

SELECT * FROM EMP WHERE MGR IS NOT NULL 
ORDER BY MGR,JOB,ENAME; -- ORDER BY 이후의 기준들 순서대로 정렬됨

SELECT * FROM EMP ORDER BY COMM DESC; -- NULL값 먼저 나온 후 정렬됨
SELECT * FROM EMP WHERE COMM IS NOT NULL ORDER BY COMM DESC; -- NULL 제외 한 후 정렬
```

*QUIZ*

```SQL
-- 5조
SELECT EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, SAL*12*0.7 AS ANSAL, DEPTNO FROM EMP
WHERE COMM IS NULL AND ENAME LIKE '%I%'

--3조
SELECT JOB, ENAME, SAL, (SAL*0.78+NVL(COMM,0)*0.88)*12 AS ANNSAL
FROM EMP
WHERE (SAL*0.78+NVL(COMM,0)*0.88)*12 > 25000
ORDER BY JOB, ENAME

-- 1조
SELECT * FROM EMP
WHERE SAL>=2000 AND SAL<=3000 AND 
(ENAME LIKE '%S%' OR JOB LIKE '%S%')
```

## 함수, 술어, CASE식

### 다양한 함수

- 함수에는 크게 나누어 산술 함수 문자열 함수, 날짜 함수, 변환 함수, 집약 함수가 있다. 
- 함수 종류가 많기 때문에 모든 것을 기억할 필요는 없다. 자주 사용하는 대표적인것만 기억해 두었다가 그 이외의 것은 필요한 시점에 찾아 보도록 한다.

산술함수

```SQL
-- +, -, *, /
-- ABS 절댓값 : ABS(수치)
-- MOD 나머지 : MOD(피제수, 제수)
SELECT ENAME, SAL, MOD(SAL,3) AS REMAIN FROM EMP;
-- ROUND 반올림 : ROUND(대상 수, 반올림 자릿수)
SELECT ENAME, SAL, ROUND(SAL/7,3) AS BONUS FROM EMP;
```

문자열함수

```SQL
-- || 연결 : 문자열1 || 문자열2
SELECT JOB||ENAME FROM EMP;
SELECT JOB||' '||ENAME AS "JOB + NAME" FROM EMP;
-- LENGTH 문자열길이 : LENGTH(문자열)

-- SUBSTRING 문자열 잘라내기
SELECT ENAME,SAL,SUBSTR(SAL,1,2)*100 FROM EMP; -- 첫번째부터 2개 숫자
SELECT ENAME,SAL,SUBSTR(SAL,2,3) FROM EMP; -- 두번째부터 3개숫자

```

날짜함수

```SQL
SELECT ENAME, HIREDATE, HIREDATE+1000 FROM EMP;

SELECT ENAME, HIREDATE,
TRUNC(SYSDATE-HIREDATE), -- 버림
ROUND(MONTHS_BETWEEN(SYSDATE, HIREDATE)) -- 반올림
FROM EMP;

SELECT ENAME, HIREDATE, 
TO_CHAR(CURRENT_TIMESTAMP,'YYYY:MM:DD:HH:MM:SS'), 
TO_CHAR(HIREDATE,'YYYY:MM:DD'), SYSDATE,
 SYSDATE-HIREDATE, 
TO_CHAR(HIREDATE,'DD'),
TO_DATE(TO_CHAR(HIREDATE, 'MM/DD'),'MM/DD')
FROM EMP
```

### 술어

```SQL
-- BETWEEN 범위 검색 (이상, 이하)
SELECT ENAME, SAL FROM EMP
WHERE SAL BETWEEN 2000 AND 5000; 
-- LIKE

-- IN & NOT IN
SELECT ENAME, SAL FROM EMP WHERE DEPTNO IN (20,30,10);
-- IS NULL & IS NOT NULL

```

### CASE 식

등급을 만들때 사용

```SQL
SELECT ENAME,
CASE WHEN JOB = 'PRESIDENT'
     THEN '왕'
     WHEN JOB = 'MANAGER'
     THEN '관리자'
     ELSE '직원'
END AS "분류"
FROM EMP;

SELECT ENAME, SAL,
CASE WHEN SAL >= 5000
     THEN '부자'
     WHEN SAL >= 3000 AND SAL < 5000
     THEN '중산층'
     ELSE '평민'
END AS "분류"
FROM EMP;
```

*QUIZ*2

```SQL
SELECT ENAME, (SAL*0.78+NVL(COMM,0)*0.88)*12 AS ANNSAL, SUBSTR((SAL*0.78+NVL(COMM,0)*0.88)*12,1,3)*100 AS "REAL ANNSAL", 
CASE WHEN (SAL*0.78+NVL(COMM,0)*0.88)*12 >= 30000
     THEN '부자'
     WHEN (SAL*0.78+NVL(COMM,0)*0.88)*12 >= 20000 AND SAL < 30000
     THEN '중산층'
     ELSE '평민'
END AS "연봉 분류"
FROM EMP
ORDER BY ANNSAL DESC, ENAME
;
```

*QUIZ3*

```sql
SELECT ENAME, HIREDATE
FROM EMP
ORDER BY TO_CHAR(HIREDATE, 'MM') DESC, ENAME
;
```

