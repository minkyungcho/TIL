## 집합 연산

### 테이블 덧셈과 뺄셈

- 

**UNION**

```SQL
-- MANAGER와 SALES 직원들의 이름과 JOB을 조회하시오
SELECT ENAME, JOB FROM EMP
WHERE JOB = 'MANAGER'
UNION
SELECT ENAME, JOB FROM EMP
WHERE JOB = 'SALESMAN'
ORDER BY JOB
```

집합연산의 주의사항

- 연산 대상이 되는 레코드의 열 수가 같을것
- 레코드의 열이 같은 데이터형일 것

```SQL
SELECT ENAME, JOB FROM EMP
WHERE JOB = 'MANAGER'
UNION
SELECT ENAME, TO_CHAR(HIREDATE, 'YYYY/MM/DD') FROM EMP
WHERE JOB = 'SALESMAN'
ORDER BY JOB
```



### 결합

내부결합 - INNER JOIN

ON 구

```SQL
SELECT e.ENAME, d.LOC FROM EMP e, DEPT d
WHERE e.DEPTNO = d.DEPTNO -- PRIMARY KEY, FOREIGN KEY RELATIONAL

SELECT e.ENAME, d.LOC FROM EMP e, DEPT d
WHERE e.DEPTNO = d.DEPTNO
AND e.JOB = 'MANAGER'
AND d.LOC IN ('CHICAGO', 'DALLAS')

-- ON
SELECT e.ENAME, d.LOC FROM EMP e INNER JOIN DEPT d
ON (e.DEPTNO = d.DEPTNO) 

SELECT e.ENAME, d.LOC FROM EMP e INNER JOIN DEPT d
ON (e.DEPTNO = d.DEPTNO)
WHERE e.JOB = 'MANAGER'
AND d.LOC = 'DALLAS'
```

VIEW 활용

```SQL
CREATE VIEW T_EMP (ENO, ENM, SAL, DNO)
AS (
	SELECT EMPNO, ENAME, SAL, DEPTNO FROM EMP
)
CREATE VIEW T_DEPT (DNO, DNM, DLOC)
AS (
	SELECT DEPTNO, DNAME, LOC FROM DEPT
)
CREATE VIEW T_SAL (ENO, ASAL)
AS (
	SELECT EMPNO, 12*(SAL+NVL(COMM,0)) FROM EMP
)
```

3개 테이블 JOIN

ENO, ENM, SAL, ASAL, DNM, DLOC

+) JONES 부서(DEPTNO 활용)원만 조회 하시오

```SQL
SELECT e.ENO, e.ENM, e.SAL , s.ASAL, d.DNM, d.DLOC 
FROM T_EMP e, T_SAL s, T_DEPT d
WHERE e.DNO = d.DNO
AND e.ENO = s.ENO
-- 표준
SELECT e.ENO, e.ENM, e.SAL , s.ASAL, d.DNM, d.DLOC 
FROM T_EMP e INNER JOIN T_DEPT d ON e.DNO = d.DNO
INNER JOIN T_SAL s ON e.ENO = s.ENO
-- +)
SELECT e.ENO, e.ENM, e.SAL , s.ASAL, d.DNM, d.DLOC 
FROM T_EMP e, T_SAL s, T_DEPT d
WHERE e.DNO = d.DNO
AND e.ENO = s.ENO
AND e.DNO IN (
    SELECT DNO FROM T_EMP 
    WHERE ENM = 'JONES'
)
```

ENO, ENM, SAL, ASAL, DNM, DLOC

+) 부서 별 연봉의 평균 보다 많이 받는 직원을 구하시오

```SQL
SELECT e.ENO, e.ENM, e.SAL, s.ASAL , d.DNM, d.DLOC 
FROM T_EMP e, T_SAL s, T_DEPT d
WHERE e.DNO = d.DNO
AND e.ENO = s.ENO
AND s.ASAL >= (
   SELECT AVG(s1.ASAL) FROM T_SAL s1, T_EMP e1
   WHERE s1.ENO = e1.ENO 
   AND e1.DNO = e.DNO
   GROUP BY e1.DNO
)
ORDER BY s.ASAL
```

직원의 정보를 출력하시오.

EMPNO, ENAME, MNAME(매니저 이름)을 출력하시오

```sql
SELECT e1.EMPNO AS EMPNO, e1.ENAME AS ENAME, e2.ENAME AS MNAME 
FROM EMP e1, EMP e2
WHERE e1.MGR = e2.EMPNO
```

OUTER JOIN

```SQL
SELECT e.ENAME, e.JOB, d.DNAME, d.LOC 
FROM EMP e LEFT OUTER JOIN DEPT d USING(DEPTNO)
--
SELECT e.ENAME, e.JOB, d.DNAME, d.LOC 
FROM EMP e RIGHT OUTER JOIN DEPT d USING(DEPTNO)


--
SELECT e.ENAME, e.JOB, d.DNAME, d.LOC 
FROM EMP e FULL OUTER JOIN DEPT d USING(DEPTNO)

```

#### RANK

랭킹 산출 EX) 1위가 3개 : 1위, 1위, 1위, 4위...

```SQL

```

#### ROW_NUMBER

순위에 상관없이 연속번호 부여 EX) 1위가 3개 : 1위, 2위, 3위, 4위...

```SQL

```

Q) SAL 5등까지 출력하시오

ENAME, SAL FROM EMP

+) TOTAL COLUMN 만들고

++) 월급의 평균도 한 열로 출력

+++) 월급 평균 반올림 소수점 2자리

```SQL
SELECT ENAME, SAL,
ROUND((SELECT AVG(SAL) FROM EMP), 2) AS ASAL, -- ++) +++)
RANK, 
(SELECT COUNT(*) FROM EMP) AS TOTAL -- +)
FROM (
   SELECT ENAME, SAL,
   RANK() OVER (ORDER BY SAL DESC) AS RANK
   FROM EMP
)
WHERE RANK <= 5
```

#### ROLLUP 

합계와 소계를 한번에 구한다.

```SQL
SELECT JOB, SUM(SAL) FROM EMP
GROUP BY JOB

-- ROLLUP 활용
SELECT JOB, SUM(SAL) FROM EMP
GROUP BY ROLLUP(JOB)
```

